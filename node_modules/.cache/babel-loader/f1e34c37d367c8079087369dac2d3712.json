{"remainingRequest":"F:\\emanager\\node_modules\\babel-loader\\lib\\index.js!F:\\emanager\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\emanager\\src\\utils\\permission.js","dependencies":[{"path":"F:\\emanager\\src\\utils\\permission.js","mtime":1604888126977},{"path":"F:\\emanager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\emanager\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\emanager\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMiOwppbXBvcnQgX01lc3NhZ2UyIGZyb20gImVsZW1lbnQtdWkvbGliL3RoZW1lLWNoYWxrL21lc3NhZ2UuY3NzIjsKaW1wb3J0ICJlbGVtZW50LXVpL2xpYi90aGVtZS1jaGFsay9iYXNlLmNzcyI7CmltcG9ydCBfTWVzc2FnZSBmcm9tICJlbGVtZW50LXVpL2xpYi9tZXNzYWdlIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRjovZW1hbmFnZXIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgTlByb2dyZXNzIGZyb20gJ25wcm9ncmVzcyc7IC8vIFByb2dyZXNzIOi/m+W6puadoQoKaW1wb3J0ICducHJvZ3Jlc3MvbnByb2dyZXNzLmNzcyc7IC8vIFByb2dyZXNzIOi/m+W6puadoeagt+W8jwoKaW1wb3J0IHJvdXRlciBmcm9tICcuLi9yb3V0ZXIvaW5kZXgnOwppbXBvcnQgc3RvcmUgZnJvbSAnLi4vc3RvcmUvaW5kZXgnOwppbXBvcnQgaTE4biBmcm9tICcuLi91dGlscy9pMThuJzsKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICcuL2F1dGgnOyAvLyDlr7zoiKrml7bmtY/op4jlmajkuIrmlrnov5vluqbmnaHphY3nva4KCk5Qcm9ncmVzcy5jb25maWd1cmUoewogIGVhc2luZzogJ2Vhc2UnLAogIC8vIOWKqOeUu+aWueW8jyAgICAKICBzcGVlZDogNTAwLAogIC8vIOmAkuWinui/m+W6puadoeeahOmAn+W6piAgICAKICBzaG93U3Bpbm5lcjogZmFsc2UsCiAgLy8g5piv5ZCm5pi+56S65Yqg6L29aWNvICAgIAogIHRyaWNrbGVTcGVlZDogMjAwLAogIC8vIOiHquWKqOmAkuWinumXtOmalCAgICAKICBtaW5pbXVtOiAwLjMgLy8g5Yid5aeL5YyW5pe255qE5pyA5bCP55m+5YiG5q+UCgp9KTsKdmFyIHdoaXRlTGlzdCA9IFsnL2xvZ2luJ107IC8vIOS4jemHjeWumuWQkeeZveWQjeWNlQoKcm91dGVyLmJlZm9yZUVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodG8sIGZyb20sIG5leHQpIHsKICAgIHZhciBwZXJtaXNzaW9ucywgaGFzUGVybWlzc2lvbjsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgTlByb2dyZXNzLnN0YXJ0KCk7IC8vIOeUqGxvY2FsU3Rvcnnph4zmnInml6B0b2tlbuWIpOaWreaYr+WQpueZu+W9lQoKICAgICAgICAgICAgaWYgKGdldFRva2VuKCkpIHsKICAgICAgICAgICAgICBpZiAodG8ucGF0aCA9PT0gJy9sb2dpbicpIHsKICAgICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAgICBwYXRoOiAnLycKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHN0b3JlLmdldHRlcnMucm9sZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdHZXRVc2VySW5mbycpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIG5leHQoKTsgLy8gY29uc3Qgcm9sZXMgPSByZXMucm9sZXMKICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdGZWRMb2dPdXQnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIF9NZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0Nsb3NlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogNCAqIDEwMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVyciB8fCBpMThuLnRjKCdlcnJvci1tZXNzYWdlLmxvZ2luLWVycm9yJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnLycKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIOWIpOaWreW9k+WJjemhtemdouaYr+WQpuacieadg+mZkAogICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyA9IHRvLm1ldGEucGVybWlzc2lvbnM7CgogICAgICAgICAgICAgICAgICBpZiAocGVybWlzc2lvbnMpIHsKICAgICAgICAgICAgICAgICAgICBoYXNQZXJtaXNzaW9uID0gaW5jbHVkZVBlcm1pc3Npb24ocGVybWlzc2lvbnMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaGFzUGVybWlzc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJy80MDEnLAogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICAgICAgICAgIG5vR29CYWNrOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHQoJy9sb2dpbicpOwogICAgICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gKF94LCBfeDIsIF94MykgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOwpyb3V0ZXIuYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHsKICBOUHJvZ3Jlc3MuZG9uZSgpOyAvLyDnu5PmnZ9Qcm9ncmVzcwp9KTsKLyoqDQogKiDliKTmlq3mmK/lkKbmi6XmnInmnYPpmZANCiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gcGVybWlzc2lvbnMgLSDopoHliKTmlq3nmoTmnYPpmZDliJfooagNCiAqLwoKZXhwb3J0IGZ1bmN0aW9uIGluY2x1ZGVQZXJtaXNzaW9uKCkgewogIHZhciBwZXJtaXNzaW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgLy8g6L+Z6YeM6KaB5Yik5pat55qE5p2D6ZmQ5rKh5pyJ6K6+572u55qE6K+d77yM5bCx562J5LqO5LiN6ZyA6KaB5p2D6ZmQ77yM55u05o6l6L+U5ZueIHRydWUKICBpZiAoIXBlcm1pc3Npb25zLmxlbmd0aCkgcmV0dXJuIHRydWU7IC8vIOiOt+WPluadg+mZkOWIl+ihqAoKICB2YXIgcGVybWlzc2lvbkxpc3QgPSBzdG9yZS5nZXR0ZXJzLnJvbGVzOyAvLyDnrqHnkIblkZjmnYPpmZDnm7TmjqXpgJrov4cKCiAgaWYgKHBlcm1pc3Npb25zLmluZGV4T2YoJ2FkbWluJykgPj0gMCkgcmV0dXJuIHRydWU7CiAgcmV0dXJuICEhcGVybWlzc2lvbnMuZmluZChmdW5jdGlvbiAocGVybWlzc2lvbikgewogICAgcmV0dXJuIHBlcm1pc3Npb25MaXN0LmluY2x1ZGVzKHBlcm1pc3Npb24pOwogIH0pOwp9"},{"version":3,"sources":["F:/emanager/src/utils/permission.js"],"names":["NProgress","router","store","i18n","getToken","configure","easing","speed","showSpinner","trickleSpeed","minimum","whiteList","beforeEach","to","from","next","start","path","done","getters","roles","length","dispatch","then","err","showClose","duration","message","tc","type","permissions","meta","hasPermission","includePermission","replace","query","noGoBack","indexOf","afterEach","permissionList","find","permission","includes"],"mappings":"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","sourcesContent":["import { Message } from 'element-ui';\r\nimport NProgress from 'nprogress'; // Progress 进度条\r\nimport 'nprogress/nprogress.css'; // Progress 进度条样式\r\nimport router from '../router/index';\r\nimport store from '../store/index';\r\nimport i18n from '../utils/i18n';\r\nimport { getToken } from './auth';\r\n\r\n// 导航时浏览器上方进度条配置\r\nNProgress.configure({\r\n  easing: 'ease',  // 动画方式    \r\n  speed: 500,  // 递增进度条的速度    \r\n  showSpinner: false, // 是否显示加载ico    \r\n  trickleSpeed: 200, // 自动递增间隔    \r\n  minimum: 0.3 // 初始化时的最小百分比\r\n})\r\n\r\n\r\nconst whiteList = ['/login'] // 不重定向白名单\r\nrouter.beforeEach(async (to, from, next) => {\r\n  NProgress.start()\r\n  // 用localStory里有无token判断是否登录\r\n  if (getToken()) {\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n      NProgress.done()\r\n    } else {\r\n      if (store.getters.roles.length === 0) {\r\n        store.dispatch('GetUserInfo').then(() => {\r\n          next()\r\n          // const roles = res.roles\r\n        }).catch((err) => {\r\n          store.dispatch('FedLogOut').then(() => {\r\n            Message({\r\n              showClose: true,\r\n              duration: 4 * 1000,\r\n              message: err || i18n.tc('error-message.login-error'),\r\n              type: 'error'\r\n            })\r\n            next({ path: '/' })\r\n          })\r\n        })\r\n      } else {\r\n        // 判断当前页面是否有权限\r\n        const { permissions } = to.meta\r\n        if (permissions) {\r\n          const hasPermission = includePermission(permissions);\r\n          if (hasPermission) {\r\n            next()\r\n          } else {\r\n            next({ path: '/401', replace: true, query: { noGoBack: true } })\r\n          }\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      next()\r\n    } else {\r\n      next('/login')\r\n      NProgress.done()\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  NProgress.done() // 结束Progress\r\n})\r\n\r\n\r\n/**\r\n * 判断是否拥有权限\r\n * @param {Array<string>} permissions - 要判断的权限列表\r\n */\r\nexport function includePermission (permissions = []) {\r\n  // 这里要判断的权限没有设置的话，就等于不需要权限，直接返回 true\r\n  if (!permissions.length) return true\r\n  // 获取权限列表\r\n  const permissionList = store.getters.roles;\r\n  // 管理员权限直接通过\r\n  if (permissions.indexOf('admin') >= 0) return true;\r\n  return !!permissions.find(permission => permissionList.includes(permission))\r\n}\r\n\r\n"]}]}