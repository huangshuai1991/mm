{"remainingRequest":"F:\\emanager\\node_modules\\babel-loader\\lib\\index.js!F:\\emanager\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\emanager\\src\\api\\ws-api.js","dependencies":[{"path":"F:\\emanager\\src\\api\\ws-api.js","mtime":1604888126269},{"path":"F:\\emanager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\emanager\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\emanager\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCBTdG9tcCBmcm9tICcuLi9wbHVnaW5zL3N0b21wJzsKdmFyIG5leHRUaW1lID0gNTAwMDsKdmFyIG1vY2s7CgppZiAocHJvY2Vzcy5lbnYuVlVFX0FQUF9JU01vY2spIHsKICBtb2NrID0gcmVxdWlyZSgnLi4vbW9jay93cy1hcGktbW9jaycpOwp9Ci8qKg0KICog5bu656uLd2Vic29ja2V06L+e5o6lDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNvbm5lY3Rpbmcg5byA5aeL6L+e5o6l5pe255qE5Zue6LCDDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNvbm5lY3RlZCDov57mjqXmiJDlip/lm57osIMNCiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uRXJyb3Ig6L+e5o6l5byC5bi45oiW5pat5byA5Zue6LCDDQogKi8KCgpmdW5jdGlvbiBjb25uZWN0KG9uQ29ubmVjdGluZywgb25Db25uZWN0ZWQsIG9uRXJyb3IpIHsKICBvbkNvbm5lY3RpbmcgaW5zdGFuY2VvZiBGdW5jdGlvbiAmJiBvbkNvbm5lY3RpbmcoKTsKICB2YXIgd3MgPSBuZXcgV2ViU29ja2V0KHByb2Nlc3MuZW52LlZVRV9BUFBfV1hfU0VSVkVSKTsKICB2YXIgY2xpZW50ID0gU3RvbXAub3Zlcih3cyk7CiAgY2xpZW50LmNvbm5lY3Qoe30sIGZ1bmN0aW9uICgpIHsKICAgIG9uQ29ubmVjdGVkIGluc3RhbmNlb2YgRnVuY3Rpb24gJiYgb25Db25uZWN0ZWQoKTsKICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oIuS4juacjeWKoeWZqOaWreW8gOi/nuaOpe+8jCIgKyBuZXh0VGltZSArICIg56eS5ZCO6YeN5paw6L+e5o6lIiwgZXJyKTsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygi5bCd6K+V6YeN6L+e4oCm4oCmIik7CiAgICAgIGNvbm5lY3Qob25Db25uZWN0aW5nLCBvbkNvbm5lY3RlZCwgb25FcnJvcik7CiAgICB9LCBuZXh0VGltZSk7CiAgICBvbkVycm9yIGluc3RhbmNlb2YgRnVuY3Rpb24gJiYgb25FcnJvcigpOwogIH0pOwp9Ci8qKg0KICog6K6i6ZiF5paw5raI5oGv77yM5bCx566X6L+e5o6l6L+Y5pyq5bu656uL5Lmf5Y+v5Lul77yM56iL5bqP5Lya6K6w5b2V6K6i6ZiF5oOF5Ya177yM5Zyo6L+e5o6l5bu656uL5ZCO5YaN5qyh6K6i6ZiFDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYiDlm57osIMNCiAqLwoKCmZ1bmN0aW9uIHN1Yk5ld01zZyhjYikgewogIHZhciB3cyA9IG5ldyBXZWJTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9XWF9TRVJWRVIpOwogIHZhciBjbGllbnQgPSBTdG9tcC5vdmVyKHdzKTsKICBjbGllbnQuc3Vic2NyaWJlKHByb2Nlc3MuZW52LlZVRV9BUFBfV1hfU0VSVkVSLCBmdW5jdGlvbiAocmVzcCkgewogICAgY29uc29sZS5kZWJ1Zygid3PmlLbliLDmtojmga86ICIgKyByZXNwLmJvZHkpOwogICAgY2IgaW5zdGFuY2VvZiBGdW5jdGlvbiAmJiBjYihyZXNwLmJvZHkpOwogIH0pOwp9CgpleHBvcnQgZGVmYXVsdCBtb2NrIHx8IHsKICBjb25uZWN0OiBjb25uZWN0LAogIHN1Yk5ld01zZzogc3ViTmV3TXNnCn07"},{"version":3,"sources":["F:/emanager/src/api/ws-api.js"],"names":["Stomp","nextTime","mock","process","env","VUE_APP_ISMock","require","connect","onConnecting","onConnected","onError","Function","ws","WebSocket","VUE_APP_WX_SERVER","client","over","err","console","warn","setTimeout","log","subNewMsg","cb","subscribe","resp","debug","body"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,kBAAlB;AAEA,IAAMC,QAAQ,GAAG,IAAjB;AACA,IAAIC,IAAJ;;AACA,IAAIC,OAAO,CAACC,GAAR,CAAYC,cAAhB,EAAgC;AAC9BH,EAAAA,IAAI,GAAGI,OAAO,CAAC,qBAAD,CAAd;AACD;AAED;;;;;;;;AAMA,SAASC,OAAT,CAAkBC,YAAlB,EAAgCC,WAAhC,EAA6CC,OAA7C,EAAsD;AACpDF,EAAAA,YAAY,YAAYG,QAAxB,IAAoCH,YAAY,EAAhD;AACA,MAAII,EAAE,GAAG,IAAIC,SAAJ,CAAcV,OAAO,CAACC,GAAR,CAAYU,iBAA1B,CAAT;AACA,MAAIC,MAAM,GAAGf,KAAK,CAACgB,IAAN,CAAWJ,EAAX,CAAb;AACAG,EAAAA,MAAM,CAACR,OAAP,CAAe,EAAf,EAAmB,YAAY;AAC7BE,IAAAA,WAAW,YAAYE,QAAvB,IAAmCF,WAAW,EAA9C;AACD,GAFD,EAEG,UAAUQ,GAAV,EAAe;AAChBC,IAAAA,OAAO,CAACC,IAAR,CAAa,cAAclB,QAAd,GAAyB,SAAtC,EAAiDgB,GAAjD;AACAG,IAAAA,UAAU,CAAC,YAAM;AACfF,MAAAA,OAAO,CAACG,GAAR,CAAY,QAAZ;AACAd,MAAAA,OAAO,CAACC,YAAD,EAAeC,WAAf,EAA4BC,OAA5B,CAAP;AACD,KAHS,EAGPT,QAHO,CAAV;AAIAS,IAAAA,OAAO,YAAYC,QAAnB,IAA+BD,OAAO,EAAtC;AACD,GATD;AAUD;AAED;;;;;;AAIA,SAASY,SAAT,CAAoBC,EAApB,EAAwB;AACtB,MAAIX,EAAE,GAAG,IAAIC,SAAJ,CAAcV,OAAO,CAACC,GAAR,CAAYU,iBAA1B,CAAT;AACA,MAAIC,MAAM,GAAGf,KAAK,CAACgB,IAAN,CAAWJ,EAAX,CAAb;AACAG,EAAAA,MAAM,CAACS,SAAP,CAAiBrB,OAAO,CAACC,GAAR,CAAYU,iBAA7B,EAAgD,UAAUW,IAAV,EAAgB;AAC9DP,IAAAA,OAAO,CAACQ,KAAR,CAAc,aAAaD,IAAI,CAACE,IAAhC;AACAJ,IAAAA,EAAE,YAAYZ,QAAd,IAA0BY,EAAE,CAACE,IAAI,CAACE,IAAN,CAA5B;AACD,GAHD;AAID;;AAED,eAAezB,IAAI,IAAI;AACrBK,EAAAA,OAAO,EAAPA,OADqB;AAErBe,EAAAA,SAAS,EAATA;AAFqB,CAAvB","sourcesContent":["import Stomp from '../plugins/stomp'\r\n\r\nconst nextTime = 5000;\r\nlet mock;\r\nif (process.env.VUE_APP_ISMock) {\r\n  mock = require('../mock/ws-api-mock')\r\n}\r\n\r\n/**\r\n * 建立websocket连接\r\n * @param {Function} onConnecting 开始连接时的回调\r\n * @param {Function} onConnected 连接成功回调\r\n * @param {Function} onError 连接异常或断开回调\r\n */\r\nfunction connect (onConnecting, onConnected, onError) {\r\n  onConnecting instanceof Function && onConnecting();\r\n  let ws = new WebSocket(process.env.VUE_APP_WX_SERVER);\r\n  let client = Stomp.over(ws);\r\n  client.connect({}, function () {\r\n    onConnected instanceof Function && onConnected();\r\n  }, function (err) {\r\n    console.warn(\"与服务器断开连接，\" + nextTime + \" 秒后重新连接\", err);\r\n    setTimeout(() => {\r\n      console.log(\"尝试重连……\");\r\n      connect(onConnecting, onConnected, onError);\r\n    }, nextTime);\r\n    onError instanceof Function && onError();\r\n  });\r\n}\r\n\r\n/**\r\n * 订阅新消息，就算连接还未建立也可以，程序会记录订阅情况，在连接建立后再次订阅\r\n * @param {Function} cb 回调\r\n */\r\nfunction subNewMsg (cb) {\r\n  let ws = new WebSocket(process.env.VUE_APP_WX_SERVER);\r\n  let client = Stomp.over(ws);\r\n  client.subscribe(process.env.VUE_APP_WX_SERVER, function (resp) {\r\n    console.debug(\"ws收到消息: \" + resp.body);\r\n    cb instanceof Function && cb(resp.body);\r\n  });\r\n}\r\n\r\nexport default mock || {\r\n  connect,\r\n  subNewMsg\r\n}\r\n"]}]}